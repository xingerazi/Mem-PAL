Requirement_Generation_Prompt="""
你是一名擅长进行「用户需求分析（Requirement Analysis）」的智能助手。

下面给你一段用户与助理之间的完整对话记录，以及一个用户问题（user_query）。
请你基于这些信息，完成以下任务。

【任务】
1. 从对话中识别用户反复强调或隐含表达的关键困扰与需求背景。
2. 理解这些需求在用户实际情境中的约束条件，而不仅是表层目标。
3. 基于上述理解，将用户的核心需求综合整理为一条「需求描述（requirement）」：
   - 该描述应体现用户希望解决的问题本质，
   - 同时反映对user_query产生影响的关键因素，
   - 而不是简单重复用户的提问或列举具体行为。
   - 在概括需求时，应从多个影响用户的角度进行综合抽象，而不是只关注单一目标

【生成要求】
- requirement 应该是 **一整句话或两到三句话**
- 语气应当 **客观、概括、偏正式**
- 不要使用“我”“你”等第一或第二人称
- 不要给出具体解决方案
- 在概括需求时，应从多个影响用户体验或效率的角度进行综合抽象，
  而不是只关注单一目标
- 不要编号、不加标题，只输出 requirement 本身

【示例（仅用于风格与抽象方式参考）】

示例输入（简化）：
- user_query：最近总觉得工作很乱，效率不高
- 对话中的重要信息：
  用户提到日常任务经常被临时事务打断，
  不同类型的工作混杂在一起，
  有时很难集中精力完成重要事项，
  长期下来感到疲惫且缺乏成效感。

示例输出（requirement）：
用户希望找到一种能够更好适应自身工作节奏的工作方式，通过更清晰的任务组织和合理的时间分配，减少频繁打断对专注度的影响，从而在保持工作连续性的同时，提高整体效率并获得更稳定、可持续的工作状态。

【对话内容】
{dialogue}

【当前用户问题（user_query）】
{user_query}

现在请直接输出生成的 requirement：
"""



# prompt.py
# prompt.py

LONG_TERM_INSIGHT_PROMPT2 = """
你是一个“长期用户画像抽取助手”，目标是从用户的连续行为日志中，
提取【稳定、可复现、对未来有指导意义】的隐含用户特征。

---
【输入】
你将收到一个按时间排序的用户行为日志列表（logs），
每条包含 timestamp 和 content。

---
【你的任务】
请你从这些日志中，提取“长期用户特征（Long-term Insights）”。

⚠️ 注意：不是总结日志，而是推断“长期状态 / 习惯 / 约束 / 偏好”。

---
【必须遵守的筛选规则】

1️⃣ 只提取 **跨时间、跨场景可印证的信息**
- 至少由 2 条及以上日志支持
- 或体现为持续行为（如多天、反复出现）

2️⃣ 只保留 **抽象层级高于具体行为的结论**
- ❌ “用户点了一杯咖啡”
- ✅ “用户长期关注胃部健康并进行医疗与饮食管理”

3️⃣ 必须对未来有潜在影响，例如：
- 健康管理
- 工作节奏
- 家庭角色
- 饮食偏好
- 时间约束

4️⃣ 以下内容一律忽略：
- 单次消费行为
- 单次娱乐浏览
- 偶发搜索
- 无法推断长期趋势的即时行为

---
【输出格式】

请严格输出 JSON 数组，不要输出任何解释性文字：

[
  {
    "insight": "一句话概括长期特征",
    "evidence": [
      "支持该结论的日志摘要1",
      "支持该结论的日志摘要2"
    ],
    "confidence": "low | medium | high"
  }
]

---
【补充要求】
- 如果没有足够证据，请返回 []
- 宁缺毋滥
"""






PROFILE_EDIT_PROMPT = """
你是一个“用户长期画像编辑器”。

系统维护一个长期用户画像，固定包含以下四个类别（每一类只记录长期、稳定、可复现的特征）：

- work（工作与职业相关）
  示例：
  - 用户从事需要频繁对接客户与协调项目的工作
  - 用户的工作节奏较快，经常需要处理多项事务
  - 用户承担团队沟通或项目推进的职责

- health（健康，身体状况以及日常饮食相关）
  示例：
  - 用户存在持续的胃部健康问题，并需要注意饮食
  - 用户长期关注身体健康，有定期运动或就医习惯
  - 用户在一段时间内需要遵循清淡饮食或服药建议

- family（家庭成员与亲密关系相关）
  示例：
  - 用户重视家庭陪伴，愿意为孩子安排时间，经常一起看动画片
  - 用户与配偶保持频繁沟通，并共同规划家庭活动和做家务

- leisure（休闲、娱乐与兴趣相关）
  示例：
  - 用户长期保持跑步、健身等运动习惯
  - 用户对电影、阅读或某类娱乐活动有持续兴趣
  - 用户倾向于通过休闲桌游活动来缓解工作压力

每个类别下是若干条长期画像描述，并且已有画像带有稳定 ID，例如：
- work: wk1, wk2, ...
- health: hl1, hl2, ...
- family: fm1, fm2, ...
- leisure: ls1, ls2, ...

---
【当前用户画像 old_profile】

{old_profile}

---
【本次新增用户日志 logs】

{logs}

---
【你的任务】
请你从这些日志中，推理并提取“长期用户特征（Long-term Insights）”。
请你判断：是否需要根据 logs，对 old_profile 进行“增量更新”。
你**只能**输出以下两种操作之一：

- add：新增一条长期画像（不写 id）
- update：更新一条已有画像（必须写已有 id）

❌ 不允许输出完整画像  
❌ 不允许新增或修改类别名称  

---
【操作规则】

1 只有在 logs 提供了“长期、可复现”的信号时，才允许操作  
2 add 用于“当前类别下还没有合适画像”的情况  
3 update 只用于“logs 明确补充 / 修正了已有画像”的情况  
4 单次输出中，每个类别最多 add 1 条  
5 只提取 跨时间、跨场景可印证的信息，只保留抽象层级高于具体行为的结论：
- ❌ “用户去医院看了胃，买了胃药”
- ✅ “用户长期关注胃部健康并进行医疗与饮食管理”
6 当类别中画像达到5条及以上的时候，不能触发add操作，只能进行update操作
7 务必确认自己的操作类别和内容的符合！ 如果是无关的长期画像也可以不添加
---
【输出格式】

请严格输出 JSON，不要输出任何解释文字：

```json
{{
  "operations": [
    {{
      "op": "add",
      "category": "health",
      "content": "新增的长期画像描述"
    }},
    {{
      "op": "update",
      "category": "work",
      "id": "wk1",
      "content": "更新后的画像描述"
    }}
  ]
}}
```
如果 logs 不触发任何长期更新，请输出：
```json
{{ "operations": [] }}
```
"""




PROFILE_CONSOLIDATE_PROMPT = """
你是一个“长期用户画像整理器（Profile Consolidator）”。

系统中已经存在一个用户长期画像 profile，包含以下固定四个类别：
- work
- health
- family
- leisure

每个类别下目前可能存在多条内容，这些内容之间**可能高度重复、冗长或语义重叠甚至出现类别错位**。

---
【当前用户长期画像 profile】

{profile}

---
【你的任务】

请你在**不引入任何新事实、不推断日志以外信息**的前提下，对该 profile 进行整理，修正：

1. 合并语义高度相似或重复的条目  
2. 保留用户的核心长期特征，不要过度简化成空话  
3. 不要删去任何有用信息！ 仅作语义合并和汇总！
4. 如果出现类别错位，请将其修正过来
---
【重要约束】

- ❌ 不允许新增类别  
- ❌ 不允许引入 profile 中未出现的新事实  
- ❌ 不允许输出日志、时间或具体一次性事件  
- ✅ 可以重写句子

---
【输出格式】

请严格输出 JSON，格式如下（示例）：

```json
{{
  "work": {{
    "wk1": "精简后的长期工作特征描述",
    "wk2": "另一条精简后的长期工作特征描述"
    ...
  }},
  "health": {{
    "hl1": "精简后的长期健康特征描述"
    ...
  }},
  "family": {{
    "fm1": "精简后的长期家庭特征描述"
    ...
  }},
  "leisure": {{
    "ls1": "精简后的长期休闲与兴趣特征描述"
    ...
  }}
}}
```
请确保：
key 仍使用原类别前缀（wk / hl / fm / ls）
id 可以重新编号（不需要与原 id 对齐）
尽量不要减少太多条数
"""